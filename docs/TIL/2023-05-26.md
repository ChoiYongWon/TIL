# 2023-05-26

## Git Config 설정

Git을 좀 더 쉽고 편하게 사용할 수 있도록 해주는 도구 활용.  
즉, Git을 자기 입맛대로 커스텀하는 과정

### core.editor

```sh
$ git config --global core.editor emacs
```

기본 편집기를 설정한다.
Git은 커밋할 때나 태그 메시지를 편집할 때 설정한 편집기를 실행한다.  
아무런 편집기를 설정하지 않았을 때 vi를 실행한다.

### commit.template

사용자가 커밋할 때 보여주는 템플릿 파일을 설정한다.  
커밋 메시지를 작성할 때 일정한 스타일을 유지할 수 있어 협업할 때 좋아보인다.

다음 명령어는 .gitmessage.txt에 템플릿을 작성하고 적용하는 역할을 한다.

```sh
$ git config --global commit.template ~/.gitmessage.txt
```

### core.pager

git의 `log`나 `diff` 명령어는 페이지 단위로 나누어 보여준다. 이런 페이지 단위로 읽는 방법을 설정하는 명령어다. 기본으로 설정되어있는 명령은 `less`이고 `more` 또는 페이지로 읽고 싶지 않은 경우 `''` 빈칸으로 두면 된다.

```sh
$ git config --global core.pager ''
```

### core.excludesfile

git에서 git add 명령으로 추적할 파일에 포함하지 않을 파일을 정의한다. 단 .gitignore와 달리 global하게 정의하고 싶을때 사용한다. 즉 한번 설정해두면 모든 저장소에 적용된다.

```sh
$ git config --global core.pager ''
```

### help.autocorrect

git은 명령어를 잘못 입력했을때 추측해서 보여준다. 하지만 직접 실행하진 않는다. 그러나 help.autocorrect를 1로 설정하면 명령어를 잘못 입력해도 자동으로 실행해준다.  
여기서 1은 명령어를 잘못입력했을때 추측한 명령어를 직접 실행하기 까지의 대기시간이다. 단위는 0.1초 단위다.

```sh
$ git config --global help.autocorrect 1
```

### merge, diff tool 바꾸기

git에 들어 있는 Diff나 Merge 툴 말고 다른 도구로 바꿀 수 있다.

설정하는법 다음과 같다.

1. 툴을 받는다.
2. Merge용 Wrapper 스크립트를 만든다.
3. Diff용 Wrapper 스크립트를 만든다.
4. git config로 적용한다.

툴을 받았다는 가정하에 Merge용 Wrapper 스크립트는 다음과 같이 작성한다.

```sh
$ cat /usr/local/bin/extMerge
#!/bin/sh
/Applications/p4merge.app/Contents/MacOS/p4merge $*
```

위 명령어는 해당 스크립트로 들어오는 Argument를 모두 p4merge 프로그램에게 넘겨주어 호출하는 스크립트이다.

다음 git diff Wrapper 스크립트를 작성해야하는데 이전에 생성한 extMerge 스크립트를 호출해준다. 기존 git이 diff 프로그램에 전달해주는 argument `path` `old-file` `old-hex` `old-mode` `new-file` `new-hex` `new-mode` 중 2개만 넘긴다.

```sh
$ cat /usr/local/bin/extDiff
#!/bin/sh
[ $# -eq 7 ] && /usr/local/bin/extMerge "$2" "$5"
```

이후, git이 실행할 수 있도록 실행권한을 부여한다.

```sh
$ sudo chmod +x /usr/local/bin/extMerge
$ sudo chmod +x /usr/local/bin/extDiff
```

그 다음 git config로 merge 툴과 diff 툴을 설정해준다.

각 명령어의 역할은 다음과 같다.

- `merge.tool` : 무슨 Merge 도구를 사용할지
- `mergetool.*.cmd` : 실제로 어떻게 명령어를 실행할지
- `mergetool.trustExitCode` : Merge 도구가 반환하는 exit 코드가 Merge의 성공 여부를 나타내는지
- `diff.external` : diff 할 때 실행할 명령어가 무엇인지

```sh
$ git config --global merge.tool extMerge
$ git config --global mergetool.extMerge.cmd \
  'extMerge "$BASE" "$LOCAL" "$REMOTE" "$MERGED"'
$ git config --global mergetool.extMerge.trustExitCode false
$ git config --global diff.external extDiff
```

### receive.fsckObjects

git이 push 할 때마다 각 개체가 SHA-1 체크섬에 맞는지, 잘못된 개체가 가리키고 있는지 검사하게 하는 옵션.  
저장소 크기와 Push 하는 양에 따라 검사 시간이 상당히 시간이 걸린다.

### receive.denyNonFastForwards

git은 한번 push한 커밋을 로컬에서 rebase 후 다시 push 하는 행동을 권하지 않고있다.  
방지하고자 위와 같은 옵션을 통해 이미 push 한 커밋을 rebase 해서 다시 push하지 못하게 할 수 있다.  
브랜치를 push 할 때 해당 리모트 브랜치가 가리키는 커밋이 push 하려는 브랜치에 없을 때 push 하지 못하게한다.

### receive.denyDeletes

브랜치를 삭제하는 Push가 거절된다.

## 클라이언트 훅

- pre-commit
  커밋할 때 가장 먼저 호출되는 훅, 커밋 메시지를 작성하기 전에 호출된다.
  커밋 전, 코드의 스타일 등을 검사할 때 사용된다.

- prepare-commit-msg
  커밋 메시지를 작성하고 커밋 객체가 생성되기 전에 실행된다.  
  커밋 메시지를 동적으로 조작하거나 템플릿을 추가하여 내용을 변경할 수 있다.

- commit-msg
  커밋 메시지가 작성된 후에 호출된다.  
  커밋 메시지를 검사하거나 특정 규칙에 맞게 수정할 수 있다.

- post-commit
  커밋이 완전히 완료된 후 호출된다.
  커밋 작업이 완료되었음을 개발자나 관련된 슬랙 채널에 알리는데 활용될 수 있다.  
   또한, 커밋이 완료된 후에 자동 빌드, 배포, 테스트 등 자동화 작업을 수행할 수 있다.

- pre-rebase
  리베이스 작업을 수행하기 전에 호출되는 훅이다. 리베이스 작업을 중지하거나 변경할 수 있는 기회를 제공한다. 안전한 리베이스를 수행할 수 있다.

- post-rewrite
  rewrite 작업이 완료된 후에 호출되는 훅이다.
  rewrite 작업은 커밋 히스토리를 수정하는 작업으로 `git commit --amend`, `git rebase`, `git filter-branch` 등과 같은 명령을 사용하여 이전 커밋을 변경하거나 재작성할 때 호출된다. rewrite 작업이 완료되었음을 개발자나 관련된 슬랙 채널 등에 알릴 때 사용된다.

- post-merge
  git에서 병합 작업이 완료된 후에 호출되는 훅이다.
  post-merge 훅도 마찬가지로 알림 및 로깅이나 자동화된 후처리 작업등에 활용될 수 있다.

- pre-push
  git push 명령을 실행하기 전에 호출되는 훅이다. 푸시 작업을 중지하거나 변경할 수 있는 기회를 제공한다.
  > ex) 테스트를 실행하여 유효성을 검증하거나, 코드 스타일 검사등을 수행

## 서버 훅

서버훅은 모두 Push 후에 실행된다.

- pre-receive
  git 서버에서 클라이언트로부터 푸시를 받기 전에 호출되는 훅이다. 다음과 같이 활용될 수 있다.

  - 변경 사항 검사 : 원격 저장소로 푸시되는 변경 사항을 검사하고, 특정 조건을 확인할 수 있다. 예를 들어, 테스트 코드를 실행하여 변경사항의 유효성을 검증할 수 있다.

  - 푸시 거부 : 특정 조건이 충족되지 않거나 변경사항에 문제가 있을 경우 푸시를 거부할 수 있다.

- update
  git에서 원격 저장소의 브랜치나 태그를 업데이트할 때 호출되는 훅이다.  
  업데이트가 되기 전에 호출되므로 업데이트에 대한 검사와 거부를 수행할 수 있다.

- post-receive
  git에서 원격 저장소로 푸시된 후에 호출되는 훅이다.
  마찬가지로 모든 푸시 작업이 완료된 후에 호출되기 때문에 알림 및 로킹이나 자동화된 후처리 작업에 활용된다.
