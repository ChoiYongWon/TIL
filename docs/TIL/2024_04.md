# 2024. 04.

## 04. 01.

### File vs Blob

File 객체는 Blob객체를 상속받은 객체이며 Blob의 모든 속성을 다 갖고 있음  
Blob이 파일 그 자체의 데이터라면 File은 메타데이터 등 부가 데이터가 존재함.  

### FileReader.readDataAsUrl vs URL.createObjectURL

다른건 없다. readDataAsUrl는 비동기적으로 처리하고 createObjectURL는 동기적으로 처리한다.  


## 04. 02.

### s3-presigned-post vs s3-request-presigner

presigned url을 사용해야하는데 두가지 방식이 보였다.  
`s3-request-presigner`는 PUT 메소드를 사용하고 만료 시간밖에 정하지 못하는 반면 `s3-presigned-post`는 POST 메소드를 사용하여 더 많은 제약 조건을 설정할 수 있다. `s3-request-presigner`의 상위 호환 느낌이다.

[s3-request-presigner AWS 공식문서](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-s3-request-presigner/)  
[s3-presigned-post AWS 공식문서](https://docs.aws.amazon.com/AWSJavaScriptSDK/v3/latest/Package/-aws-sdk-s3-presigned-post/)  

[POST 메소드를 활용한 제약조건 예시](https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-HTTPPOSTConstructPolicy.html)  

[S3-Presigned-Url-도입하기](https://velog.io/@invidam/S3-Presigned-Url-%EB%8F%84%EC%9E%85%ED%95%98%EA%B8%B0)  


## 04. 03.

### 이미지 압축 처리에 대한 고민

사용자가 이미지와 게시물을 업로드할때 이미지를 압축하고 싶다.  
클라이언트에서 하기엔 사용자 경험이 안좋고, 서버에서 하기엔 효율이 떨어지는 느낌이다.  

AWS lambda를 사용하여 s3에 origin 버킷으로 이미지가 업로드 되었을 때 동작하여 이미지를 압축하여 resize 버킷으로 재 업로드하는 전략이다.  
resize 버킷으로의 업로드 성공 후 게시물을 업로드 하고싶다.  



### lambda 에서 sharp로 이미지 압축

> 최신 버전의 sharp(0.33)는 Lambda와 호환되지 않는다. `0.32.6` 버전을 사용해야한다.

```sh

npm install --arch=x64 --platform=linux --target=16x sharp@0.32.6

```


[더 나은 사용자 경험을 위한 이미지 리사이징을 해보자](https://medium.com/@wj2kim/%EB%8D%94-%EB%82%98%EC%9D%80-%EC%82%AC%EC%9A%A9%EC%9E%90-%EA%B2%BD%ED%97%98%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%A6%AC%EC%82%AC%EC%9D%B4%EC%A7%95%EC%9D%84-%ED%95%B4%EB%B3%B4%EC%9E%90-cffbb55b9d95)  
[자습서: Amazon S3 트리거를 사용하여 썸네일 이미지 생성](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/with-s3-tutorial.html)  